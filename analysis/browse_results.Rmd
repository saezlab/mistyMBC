---
title: "browse_results"
author: "Jovan Tanevski"
date: "`r Sys.Date()`"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

# Setup

Load necessary libraries

```{r setup, message=FALSE}
library(stringr)
library(dplyr)
library(mistyR)
library(future)

plan(multisession)        
```

# Output collection

Find the location of the results for all samples

```{r}
outputs <- str_subset(list.dirs("output"), "processed") %>% 
  str_subset("failed", negate = TRUE)
```

Collect the results for all samples, single modality and all replicates

```{r}
misty.results.codex <- collect_results(str_subset(outputs, "codex"))
misty.results.merfish <- collect_results(str_subset(outputs, "merfish"))
misty.results.ligrcp <- collect_results(str_subset(outputs, "ligrcp"))
misty.results.ligpath <- collect_results(str_subset(outputs, "ligpath"))
```

# Plot basic results

## CODEX

Filter only genes with mean gain in variance explained of 1 or more to plot the gain and view contributions
```{r}
misty.results.codex %>%
  plot_improvement_stats(trim = 1) %>%
  plot_view_contributions(trim = 1)
```

Plot interaction heatmaps
```{r}
misty.results.codex %>%
  plot_interaction_heatmap("intra", cutoff = 3, clean = TRUE) %>%
  plot_interaction_heatmap("juxta.15", cutoff = 0.75, clean = TRUE, trim = 1) %>%
  plot_interaction_heatmap("para.100", cutoff = 0.75, clean = TRUE, trim = 1)
```


Plot contrasts
```{r}
misty.results.codex %>%
  plot_contrast_heatmap("intra", "juxta.15", cutoff = 0.75, trim = 1) %>%
  plot_contrast_heatmap("intra", "para.100", cutoff = 0.75, trim = 1)

```

Plot interaction communities 

```{r}
misty.results.codex %>%    
  plot_interaction_communities("intra", cutoff = 3) %>%
  plot_interaction_communities("juxta.15", cutoff = 1) %>%
  plot_interaction_communities("para.100", cutoff = 1)
```


## MERFISH

Filter only genes with mean gain in variance explained of 1 or more to plot the gain and view contributions

```{r}
misty.results.merfish %>%
  plot_improvement_stats(trim = 1) %>%
  plot_view_contributions(trim = 1)
```


Plot interaction heatmaps
```{r}
misty.results.merfish %>%
  plot_interaction_heatmap("intra", cutoff = 6, clean = TRUE) %>%
  plot_interaction_heatmap("juxta.15", cutoff = 2, clean = TRUE, trim = 1) %>%
  plot_interaction_heatmap("para.100", cutoff = 1, clean = TRUE, trim = 1)
```

Plot contrasts
```{r}
misty.results.merfish %>% 
  plot_contrast_heatmap("intra", "juxta.15", cutoff = 1.5, trim = 1) %>%  
  plot_contrast_heatmap("intra", "para.100", cutoff = 1, trim = 1)
```


Plot interaction communities 

```{r}
misty.results.merfish %>%    
  plot_interaction_communities("intra", cutoff = 6) %>%
  plot_interaction_communities("juxta.15", cutoff = 3) %>%
  plot_interaction_communities("para.100", cutoff = 1.5)
```

## Merge CODEX and MERFISH results

Filter only genes with mean gain in variance explained of 1 or more to plot the gain and view contributions
```{r}
misty.results.merged <- collect_results(str_subset(outputs, "codex|merfish"))

misty.results.merged %>% plot_improvement_stats(trim = 1) %>%
  plot_view_contributions(trim = 1)
```

Plot interaction heatmaps
```{r}
misty.results.merged %>%
  plot_interaction_heatmap("intra", cutoff = 6, clean = TRUE) %>%
  plot_interaction_heatmap("juxta.15", cutoff = 1.5, clean = TRUE, trim = 1) %>%
  plot_interaction_heatmap("para.100", cutoff = 1, clean = TRUE, trim = 1)
```



## SlideSeq

Filter only ligands then pathways with mean gain in variance explained of 1 or more to plot the gain and view contributions

```{r}
misty.results.ligrcp %>% 
  plot_improvement_stats(trim = 0.5) %>%
  plot_view_contributions(trim = 0.5)
```

```{r}
misty.results.ligpath %>% 
  plot_improvement_stats(trim = 1) %>%
  plot_view_contributions(trim = 1)
```

Plot interaction heatmaps
```{r}
  misty.results.ligrcp %>%
    plot_interaction_heatmap("intra", cutoff = 5, clean = TRUE) %>%
    plot_interaction_heatmap("para.100", cutoff = 2, clean = TRUE, trim = 0.5)

misty.results.ligpath %>%
    plot_interaction_heatmap("intra", cutoff = 1, clean = TRUE) %>%
    plot_interaction_heatmap("para.100", cutoff = 1.5, clean = TRUE, trim = 1)
```

Plot intrinsic pathway communities

```{r}
misty.results.ligpath %>% plot_interaction_communities("intra", cutoff = 1)
```

