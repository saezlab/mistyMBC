---
title: "browse_results"
author: "Jovan Tanevski"
date: "`r Sys.Date()`"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

# Setup

Load necessary libraries

```{r setup, message=FALSE}
library(stringr)
library(dplyr)
library(mistyR)
library(future)

plan(multisession)        
```

# Output collection

Find the location of the results for all samples

```{r}
outputs <- str_subset(list.dirs("output"), "processed") %>% 
  str_subset("failed", negate = TRUE)
```

Collect the results for all samples, single modality and all replicates

```{r}
misty.results.codex <- collect_results(str_subset(outputs, "codex"))
misty.results.merfish <- collect_results(str_subset(outputs, "merfish"))
misty.results.ligrcp <- collect_results(str_subset(outputs, "ligrcp"))
misty.results.ligpath <- collect_results(str_subset(outputs, "ligpath"))
```

# Plot basic results

## CODEX

Filter only genes with mean gain in variance explained of 1 or more to plot the gain and view contributions
```{r}
  misty.results.codex %>%
    plot_improvement_stats(trim = 1) %>%
    plot_view_contributions(trim = 1)
```

Plot interaction heatmaps
```{r}
  misty.results.codex %>%
    plot_interaction_heatmap("intra", 3, clean = TRUE) %>%
    plot_interaction_heatmap("juxta.15", 2, clean = TRUE) %>%
    plot_interaction_heatmap("para.100", 2, clean = TRUE)
```


Plot contrasts conservatively
```{r}
  misty.results.codex %>%
    plot_contrast_heatmap("intra", "juxta.15", cutoff = 2) %>%
    plot_contrast_heatmap("intra", "para.100", cutoff = 2)

```

Plot interaction communities 

```{r}
misty.results.codex %>%    
  plot_interaction_communities("intra", 3) %>%
  plot_interaction_communities("juxta.15", 2) %>%
  plot_interaction_communities("para.100", 2)
```


## MERFISH

Filter only genes with mean gain in variance explained of 1 or more to plot the gain and view contributions

```{r}
misty.results.merfish %>%
  plot_improvement_stats(trim = 1) %>%
  plot_view_contributions(trim = 1)
```


Plot interaction heatmaps
```{r}
  misty.results.merfish %>%
    plot_interaction_heatmap("intra", 5, clean = TRUE) %>%
    plot_interaction_heatmap("juxta.15", 3, clean = TRUE) %>%
    plot_interaction_heatmap("para.100", 2, clean = TRUE)
```

Plot contrasts
```{r}
misty.results.merfish %>% 
  plot_contrast_heatmap("intra", "juxta.15", 2) %>%  
  plot_contrast_heatmap("intra", "para.100", 1.5)
```


Plot interaction communities 

```{r}
misty.results.merfish %>%    
  plot_interaction_communities("intra", 5) %>%
  plot_interaction_communities("juxta.15", 3) %>%
  plot_interaction_communities("para.100", 2)
```

## SlideSeq

Filter only ligands then pathways with mean gain in variance explained of 1 or more to plot the gain and view contributions

```{r}
misty.results.ligrcp %>% 
  plot_improvement_stats(trim = 0.5) %>%
  plot_view_contributions(trim = 0.5)
```

```{r}
misty.results.ligpath %>% 
  plot_improvement_stats(trim = 1) %>%
  plot_view_contributions(trim = 1)
```

Plot interaction heatmaps
```{r}
  misty.results.ligrcp %>%
    plot_interaction_heatmap("intra", 5, clean = TRUE) %>%
    plot_interaction_heatmap("para.100", 4, clean = TRUE)

misty.results.ligpath %>%
    plot_interaction_heatmap("intra", 1, clean = TRUE) %>%
    plot_interaction_heatmap("para.100", 1.5, clean = TRUE)
```

Plot intrinsic pathway communities

```{r}
misty.results.ligpath %>% plot_interaction_communities("intra", 1)
```

